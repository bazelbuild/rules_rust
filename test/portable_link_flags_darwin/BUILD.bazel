load("@rules_rust//rust:defs.bzl", "rust_binary", "rust_library")

rust_library(
    name = "rust-lib",
    edition = "2021",
    srcs = ["lib.rs"],
)

cc_library(
    name = "c-lib",
    srcs = ["api.c"],
    deps = [":rust-lib"],
)

rust_binary(
    name = "app",
    edition = "2021",
    srcs = ["main.rs"],
    deps = [":c-lib"],
)

sh_test(
    name = "test",
    data = [":app"],
    srcs = ["test.sh"],
    args = ["$(location :app)"],
    target_compatible_with = [
        "@platforms//os:macos",
    ]
)