load("@rules_cc//cc:defs.bzl", "cc_library", "cc_test")
load(
    "@rules_rust//rust:defs.bzl",
    "rust_binary",
    "rust_library",
    "rust_shared_library",
    "rust_library_group",
    "rust_test",
)

cc_library(
    name = "cclinkstampdep",
    linkstamp = "cclinkstampdep.cc",
)

rust_library(
    name = "deep_dep",
    srcs = ["deep_dep.rs"],
    edition = "2021",
)

rust_library_group(
    name = "dep_group",
    deps = [":deep_dep"],
)

rust_library(
    name = "very_nested_dep",
    srcs = ["very_nested_dep.rs"],
    edition = "2021",
)

rust_library_group(
    name = "nested_dep_group",
    deps = [":very_nested_dep"],
)

rust_library(
    name = "nesting_dep",
    srcs = ["nesting_dep.rs"],
    deps = [":nested_dep_group"],
    edition = "2021",
)

rust_library(
    name = "rdep",
    srcs = ["rdep.rs"],
    edition = "2021",
)

rust_binary(
    name = "bin",
    srcs = ["bin.rs"],
    edition = "2021",
    deps = [
        ":cclinkstampdep",
        ":rdep",
        ":dep_group",
        ":nesting_dep",
    ],
)

rust_test(
    name = "test",
    srcs = ["test.rs"],
    edition = "2021",
    deps = [":rdep"],
)

rust_test(
    name = "subdirectory/test",
    srcs = ["test.rs"],
    edition = "2021",
    deps = [":rdep"],
)

rust_test(
    name = "test-with-dashes-in-the-name",
    srcs = ["test.rs"],
    edition = "2021",
    deps = [":rdep"],
)

rust_shared_library(
    name = "cdylib",
    srcs = ["lib.rs"],
    edition = "2021",
)

cc_test(
    name = "main",
    srcs = [
        "main.cc",
    ],
    deps = [":cdylib"],
)
